<div class="flex flex-col h-screen items-center justify-center">
  <div class="max-w-md p-8">
    @switch (state$ | async) {
      @case ('form') {
        <h2 class="text-xl font-semibold mb-4">Set new password</h2>
        <p class="text-gray-500 mb-6">
          Enter your new password below.
        </p>

        <form [formGroup]="form" (ngSubmit)="submitForm()" class="flex flex-col">
          <div class="flex flex-col mb-4">
            <label class="mb-1 text-sm" for="password">New Password</label>
            <input
              class="input-outline mb-0"
              type="password"
              formControlName="password"
              placeholder="••••••••"
              autocomplete="new-password"
            />
            <span class="text-xs pb-2 text-red">
              <form-error [control]="form.get('password')"></form-error>
            </span>
            <span class="text-xs text-gray-500">Minimum 8 characters</span>
          </div>

          <div class="flex flex-col mb-4">
            <label class="mb-1 text-sm" for="confirmPassword">Confirm Password</label>
            <input
              class="input-outline mb-0"
              type="password"
              formControlName="confirmPassword"
              placeholder="••••••••"
              autocomplete="new-password"
            />
            <span class="text-xs pb-2 text-red">
              <form-error [control]="form.get('confirmPassword')"></form-error>
            </span>
          </div>

          @if (error$ | async; as error) {
            <p class="text-red text-sm mb-4">{{ error }}</p>
          }

          <button
            class="btn-blue shadow w-full"
            [disabled]="form.invalid || (loading$ | async)"
            type="submit"
          >
            @if (loading$ | async) {
              <span>Resetting...</span>
            } @else {
              Reset password
            }
          </button>
        </form>
      }

      @case ('success') {
        <h2 class="text-xl font-semibold mb-4 text-green-600">Password reset!</h2>
        <p class="text-gray-500 mb-4">
          Your password has been reset. Redirecting to dashboard...
        </p>
      }

      @case ('error') {
        <h2 class="text-xl font-semibold mb-4 text-red">Reset failed</h2>
        <p class="text-gray-500 mb-4">
          The reset link is invalid or has expired.
        </p>
        <a routerLink="/sign-in/forgot-password" class="btn-blue">
          Request new link
        </a>
      }
    }

    @if ((state$ | async) === 'form') {
      <a routerLink="/sign-in" class="text-sm text-blue mt-4 block">
        Back to Sign in
      </a>
    }
  </div>
</div>
