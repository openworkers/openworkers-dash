<div>
  @if (database$ | async; as database) {
    <div class="card shadow-sm mt-8">
      <div class="inline-block p-4 w-full">
        <h4>Connection Info</h4>
        <div class="mt-4">
          <label class="text-sm text-gray-500">Database ID</label>
          <div class="font-mono text-sm bg-gray-100 dark:bg-gray-800 p-2 rounded">{{ database.id }}</div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm mt-8">
      <div class="inline-block p-4 w-full">
        <h4>API Token</h4>
        <div class="mt-4">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Your API token is used to authenticate requests to this database. If you've lost your token or need a new one, you can regenerate it below.
          </p>
          <p class="text-sm text-amber-600 dark:text-amber-400 mt-2">
            Warning: Regenerating will invalidate your current token.
          </p>
          <div class="mt-4">
            <button
              class="btn-outline"
              (click)="regenerateToken()"
              [disabled]="isRegenerating()"
            >
              {{ isRegenerating() ? 'Regenerating...' : 'Regenerate Token' }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="card shadow-sm mt-8">
      <div class="inline-block p-4 w-full">
        <h4>Usage</h4>
        <div class="mt-4">
          <p class="text-sm text-gray-600 dark:text-gray-400">
            Use this in your worker to query the database. Store your token in an environment variable.
          </p>
          <div class="mt-4">
            <pre class="text-xs bg-gray-100 dark:bg-gray-800 p-3 rounded block overflow-x-auto"><code>const res = await fetch('https://pg.openworkers.com/query', &#123;
  method: 'POST',
  headers: &#123;
    'Content-Type': 'application/json',
    'Authorization': `Bearer $&#123;env.DATABASE_TOKEN&#125;`
  &#125;,
  body: JSON.stringify(&#123;
    sql: 'SELECT * FROM users WHERE id = $1',
    params: [userId]
  &#125;)
&#125;);

const &#123; rows &#125; = await res.json();</code></pre>
          </div>
        </div>
      </div>
    </div>

    <app-debug [expand]="true">{{ database | json }}</app-debug>
  }
</div>

<!-- Token Modal - shown after regenerating token -->
<app-modal [open]="showTokenModal()" (openChange)="showTokenModal.set($event)" [closable]="false" variant="small">
  <div role="header">
    <h4>New Token Generated</h4>
  </div>
  <div role="body">
    <p class="mb-4 text-sm">
      Your new API token has been generated. <strong>Copy it now</strong> - you won't be able to see it again.
    </p>
    <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-md font-mono text-sm break-all">
      {{ generatedToken() }}
    </div>
    <p class="mt-3 text-xs text-gray-500">
      Use this token in the Authorization header: <code>Bearer {{ generatedToken().substring(0, 15) }}...</code>
    </p>
  </div>
  <div role="footer" class="flex gap-2 justify-end">
    <button class="btn-outline" (click)="copyToken()">
      {{ tokenCopied() ? 'Copied!' : 'Copy Token' }}
    </button>
    <button class="btn-primary" (click)="closeTokenModal()">
      I've saved my token
    </button>
  </div>
</app-modal>
