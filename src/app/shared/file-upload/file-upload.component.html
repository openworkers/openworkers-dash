<div
  class="border-2 border-dashed rounded-lg p-6 text-center transition-colors"
  [class.border-blue-500]="isDragging"
  [class.bg-blue-50]="isDragging"
  [class.dark:bg-blue-900/20]="isDragging"
  [class.border-gray-300]="!isDragging"
  [class.dark:border-gray-600]="!isDragging"
  (dragover)="onDragOver($event)"
  (dragleave)="onDragLeave($event)"
  (drop)="onDrop($event)"
>
  @if (uploadState$ | async; as state) {
    @if (state.uploading) {
      <div class="py-4">
        <p class="text-sm text-gray-600 dark:text-gray-400">Uploading {{ state.current + 1 }} / {{ state.total }}</p>
        <p class="text-xs text-gray-500 mt-1 font-mono truncate">{{ state.currentFile }}</p>
        <div class="mt-2 h-2 bg-gray-200 dark:bg-gray-700 rounded overflow-hidden">
          <div class="h-full bg-blue-500 transition-all" [style.width.%]="(state.current / state.total) * 100"></div>
        </div>
      </div>
    } @else if (files.length === 0) {
      <div class="py-4">
        <p class="text-gray-600 dark:text-gray-400 mb-2">Drag & drop files or folders here</p>
        <p class="text-sm text-gray-500 mb-4">or</p>
        <div class="flex justify-center gap-2">
          <label class="btn-light cursor-pointer">
            Browse files
            <input type="file" class="hidden" multiple (change)="onFileSelected($event)" />
          </label>
          <label class="btn-light cursor-pointer">
            Browse folder
            <input type="file" class="hidden" webkitdirectory (change)="onFileSelected($event)" />
          </label>
        </div>
      </div>
    } @else {
      <div class="text-left">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-gray-600 dark:text-gray-400"> {{ files.length }} file(s) selected </span>
          <div class="flex gap-2">
            <label class="text-sm text-blue-600 hover:text-blue-800 cursor-pointer">
              + Files
              <input type="file" class="hidden" multiple (change)="onFileSelected($event, true)" />
            </label>
            <label class="text-sm text-blue-600 hover:text-blue-800 cursor-pointer">
              + Folder
              <input type="file" class="hidden" webkitdirectory (change)="onFileSelected($event, true)" />
            </label>
            <button class="text-sm text-gray-500 hover:text-gray-700" (click)="clearFiles()">Clear</button>
          </div>
        </div>

        <div class="max-h-48 overflow-y-auto border rounded dark:border-gray-700">
          @for (file of files; track $index; let i = $index) {
            <div
              class="flex justify-between items-center px-3 py-2 text-sm border-b dark:border-gray-700 last:border-b-0"
            >
              <span class="font-mono text-xs truncate flex-1 mr-2">{{ file.name }}</span>
              <span class="text-gray-500 text-xs mr-2">{{ formatSize(file.size) }}</span>
              <button class="text-red-500 hover:text-red-700 text-xs" (click)="removeFile(i)">Remove</button>
            </div>
          }
        </div>

        @if (error) {
          <div class="mt-2 p-2 bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 rounded text-sm">
            {{ error }}
          </div>
        }

        <div class="mt-4 flex justify-end">
          <button class="btn-blue" (click)="upload()">Upload {{ files.length }} file(s)</button>
        </div>
      </div>
    }
  }
</div>
